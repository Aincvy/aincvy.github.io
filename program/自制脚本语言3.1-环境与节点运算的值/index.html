<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  
  <link rel="prev" href="https://fantasyplayer.link/program/%E8%87%AA%E5%88%B6%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%802-%E7%B1%BB%E5%9E%8B%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9%E7%9A%84%E4%BB%8B%E7%BB%8D/" />
  <link rel="next" href="https://fantasyplayer.link/program/%E8%87%AA%E5%88%B6%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%803.2-%E6%8A%BD%E8%B1%A1%E8%AF%AD%E6%B3%95%E6%A0%91%E7%9A%84%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/" />
  <link rel="canonical" href="https://fantasyplayer.link/program/%E8%87%AA%E5%88%B6%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%803.1-%E7%8E%AF%E5%A2%83%E4%B8%8E%E8%8A%82%E7%82%B9%E8%BF%90%E7%AE%97%E7%9A%84%E5%80%BC/" />
  <link rel='shortcut icon' type='image/x-icon' href='/favicon.ico' />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           自制脚本语言[3.1] 环境与节点运算的值 | Fanstasy Player / 幻想系玩家
       
  </title>
  <meta name="title" content="自制脚本语言[3.1] 环境与节点运算的值 | Fanstasy Player / 幻想系玩家">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="自制脚本语言[3.1] 环境与节点运算的值"/>
<meta name="twitter:description" content="本篇来描述一下 ”环境“相关的内容。
这部分内容是笔者从《两周自制脚本语言》这本书上学来的。
简单来说 环境就是一个K-V形式的Map。
 Key 是变量名 Value 是 变量值 一个环境表示一个作用域。 比如函数内部，类内部，脚本内部等。  这里需要提一下， 如果读者使用Java语言来实现脚本语言引擎，或者读者只是想学习一下，或者读者只是追求一个简单的脚本语言引擎，那么建议使用这种方式， 否则，不建议使用这种方式。
如果读者想实现一个复杂的， 稳定的脚本语言引擎， 那么建议使用变量表的形式来实现环境。
一个例子是使用数组或者链表来存放变量的值，对变量的引用在编译期间转换成具体的索引，而非变量名。
由于笔者还没有实现过相关的方式，所以本篇不讨论相关内容。也许后面笔者实现过了之后 会写一篇博文进行相关介绍 😂😂😂
详细说明 我们先来讨论一下 最简单的赋值行为。
先看一下下面的代码。
// 本段代码的内容都是在一个脚本文件内部的。 a = 1; b = &#34;hello&#34;; c = new Test(); d = a &#43; 1; 为了使变量这个功能得以实现， 我们需要保存变量的当前值， 以使未来在使用这个变量的时候可以获取到正确的值。
所以我们可以使用下面的方式进行实现。
 新建一个新的 Map ，用于表示脚本的环境。 碰到 a = 1; 这条语句的时候， 把a的值 设置成 1 碰到 b = &quot;hello&quot;; 这条语句的时候， 把b的值设置成hello 碰到 c = new Test(); 的时候， 实例化 Test类，生成一个对象，并将对象的引用赋值给c 碰到 d = a &#43; 1;  这条语句的时候， 首先取出a的值， 然后进行加法运算， 之后将结果赋值给 d  附注："/>

  <script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "自制脚本语言[3.1] 环境与节点运算的值",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/fantasyplayer.link\/program\/%E8%87%AA%E5%88%B6%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%803.1-%E7%8E%AF%E5%A2%83%E4%B8%8E%E8%8A%82%E7%82%B9%E8%BF%90%E7%AE%97%E7%9A%84%E5%80%BC\/"
  },
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/fantasyplayer.link\/cover.png",
    "width":  800 ,
    "height":  600 
  },
  "genre": "program",
  
  "wordcount":  144 ,
  "url": "https:\/\/fantasyplayer.link\/program\/%E8%87%AA%E5%88%B6%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%803.1-%E7%8E%AF%E5%A2%83%E4%B8%8E%E8%8A%82%E7%82%B9%E8%BF%90%E7%AE%97%E7%9A%84%E5%80%BC\/",
  "datePublished": "2021-02-07T15:00:56\x2b08:00",
  "dateModified": "2021-02-07T15:00:56\x2b08:00",
  
  "publisher": {
    "@type": "Organization",
    "name": "hideDragon",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/fantasyplayer.link\/logo.png",
      "width":  127 ,
      "height":  40 
    }
  },
  "author": {
    "@type": "Person",
    "name": "hideDragon"
  },
  "description": ""
}
</script>
</head>

  



  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="https://fantasyplayer.link/">Fanstasy Player / 幻想系玩家</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/program/" title="">Program</a>
                
                <a class="menu-item" href="/caprice/" title="">Caprice</a>
                
                <a class="menu-item" href="/periphery/" title="">Periphery</a>
                
                <a class="menu-item" href="/series/" title="">Series</a>
                
                <a class="menu-item" href="/about" title="">About</a>
                
                <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-sun"></i></a>&nbsp;
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-sun"></i></a>&nbsp;<a href="https://fantasyplayer.link/">Fanstasy Player / 幻想系玩家</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/program/" title="">Program</a>
                
                <a class="menu-item" href="/caprice/" title="">Caprice</a>
                
                <a class="menu-item" href="/periphery/" title="">Periphery</a>
                
                <a class="menu-item" href="/series/" title="">Series</a>
                
                <a class="menu-item" href="/about" title="">About</a>
                
        </div>
    </div>
</nav>

    	 <main class="main">
          <div class="container">
      		
<article class="post-warp">
    <header class="post-header">
        <h1 class="post-title">自制脚本语言[3.1] 环境与节点运算的值</h1>
        <div class="post-meta">
            Written by <a href="https://fantasyplayer.link/" rel="author">hideDragon</a> with ♥ 
                <span class="post-time">
                    on <time datetime=2021-02-07 >7 February 2021</time>
                </span>
                in
                
                <i class="iconfont icon-timer"></i>
                1 min
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <p>本篇来描述一下 ”环境“相关的内容。</p>
<p>这部分内容是笔者从《两周自制脚本语言》这本书上学来的。</p>
<p>简单来说 环境就是一个K-V形式的Map。</p>
<ul>
<li>Key 是变量名</li>
<li>Value 是 变量值</li>
<li>一个环境表示一个作用域。 比如函数内部，类内部，脚本内部等。</li>
</ul>
<p>这里需要提一下， 如果读者使用Java语言来实现脚本语言引擎，或者读者只是想学习一下，或者读者只是追求一个简单的脚本语言引擎，那么建议使用这种方式， <strong>否则，不建议使用这种方式。</strong></p>
<p>如果读者想实现一个复杂的， 稳定的脚本语言引擎， 那么建议使用变量表的形式来实现环境。</p>
<p><em>一个例子是使用数组或者链表来存放变量的值，对变量的引用在编译期间转换成具体的索引，而非变量名。</em></p>
<p>由于笔者还没有实现过相关的方式，所以本篇不讨论相关内容。<em>也许后面笔者实现过了之后 会写一篇博文进行相关介绍 😂😂😂</em></p>
<h2 id="详细说明">详细说明</h2>
<p>我们先来讨论一下 最简单的赋值行为。</p>
<p>先看一下下面的代码。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">// 本段代码的内容都是在一个脚本文件内部的。

a = 1;
b = &#34;hello&#34;;
c = new Test();

d = a + 1;
</code></pre></div><p>为了使变量这个功能得以实现， 我们需要保存变量的当前值， 以使未来在使用这个变量的时候可以获取到正确的值。</p>
<p>所以我们可以使用下面的方式进行实现。</p>
<ol>
<li>新建一个新的 Map ，用于表示脚本的环境。</li>
<li>碰到 <code>a = 1;</code> 这条语句的时候， 把a的值 设置成 1</li>
<li>碰到 <code>b = &quot;hello&quot;;</code> 这条语句的时候， 把b的值设置成hello</li>
<li>碰到 <code>c = new Test();</code> 的时候， 实例化 Test类，生成一个对象，并将对象的引用赋值给c</li>
<li>碰到 <code>d = a + 1; </code> 这条语句的时候， 首先取出a的值， 然后进行加法运算， 之后将结果赋值给 d</li>
</ol>
<p>附注：</p>
<ul>
<li>新建一个Map的地方， 可以考虑使用 <code>std::map&lt;k,v&gt;</code>  或者自定义的<code>Enviroment</code> 类之类的。</li>
<li>关于 <code>new Test()</code> 和 <code>d = a + 1;</code> 的语句 在后续文章会有更加详细的说明。</li>
</ul>
<p>当所有语句执行结束之后，我们应该会得到一个如下的一个Map。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">a:   1
b:   hello
c:   一个指向 Test对象的引用 

d:   2
</code></pre></div><p>此时，我们追加执行一条语句 <code>a = a + 1;</code>  之后， a的值会被更新成2 。</p>
<p>现在新的Map 应该是如下这个样子的。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">a:   2
b:   hello
c:   一个指向 Test对象的引用 

d:   2
</code></pre></div><p>本篇只是提供了一些实现上的思路，并没有提供具体的代码。 想要看代码的读者可以看看langX里的相关实现。</p>
<p>langX中的相关实现都在 <code>Enviroment.h</code> 和<code>Enviroment.cpp</code> 两个文件中。</p>
<h2 id="关于节点的一些简单说明">关于节点的一些简单说明</h2>
<p>这里说的节点表示抽象语法树上的一个节点， 将会在下一篇中进行说明。</p>
<h2 id="其他">其他</h2>
<p>在JAVA函数的实现中，存在一个叫做 局部变量表的东西， 这个表里的每一个元素都是变量的值，在使用这个表的时候，就是根据索引来操作的。</p>
<p>索引应该会在编译阶段产生，并生成到字节码里面。</p>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>hideDragon </span>
                </p>
            
           
            <p class="copyright-item">
                    <span>Words:</span>
                   <span>144</span>
            </p>
            
            <p class="copyright-item">
                
                <span>Share:</span>
                <span>

      
        <a href="//twitter.com/share?url=https%3a%2f%2ffantasyplayer.link%2fprogram%2f%25E8%2587%25AA%25E5%2588%25B6%25E8%2584%259A%25E6%259C%25AC%25E8%25AF%25AD%25E8%25A8%25803.1-%25E7%258E%25AF%25E5%25A2%2583%25E4%25B8%258E%25E8%258A%2582%25E7%2582%25B9%25E8%25BF%2590%25E7%25AE%2597%25E7%259A%2584%25E5%2580%25BC%2f&amp;text=%e8%87%aa%e5%88%b6%e8%84%9a%e6%9c%ac%e8%af%ad%e8%a8%80%5b3.1%5d%20%e7%8e%af%e5%a2%83%e4%b8%8e%e8%8a%82%e7%82%b9%e8%bf%90%e7%ae%97%e7%9a%84%e5%80%bc&amp;via=Aincvy" target="_blank" title="Share on Twitter">
          <i class="iconfont icon-twitter"></i>
        </a>
        
      
      
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ffantasyplayer.link%2fprogram%2f%25E8%2587%25AA%25E5%2588%25B6%25E8%2584%259A%25E6%259C%25AC%25E8%25AF%25AD%25E8%25A8%25803.1-%25E7%258E%25AF%25E5%25A2%2583%25E4%25B8%258E%25E8%258A%2582%25E7%2582%25B9%25E8%25BF%2590%25E7%25AE%2597%25E7%259A%2584%25E5%2580%25BC%2f" target="_blank" title="Share on Facebook">
          <i class="iconfont icon-facebook"></i>
        </a>
        
      
      
      
      
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2ffantasyplayer.link%2fprogram%2f%25E8%2587%25AA%25E5%2588%25B6%25E8%2584%259A%25E6%259C%25AC%25E8%25AF%25AD%25E8%25A8%25803.1-%25E7%258E%25AF%25E5%25A2%2583%25E4%25B8%258E%25E8%258A%2582%25E7%2582%25B9%25E8%25BF%2590%25E7%25AE%2597%25E7%259A%2584%25E5%2580%25BC%2f&amp;title=%e8%87%aa%e5%88%b6%e8%84%9a%e6%9c%ac%e8%af%ad%e8%a8%80%5b3.1%5d%20%e7%8e%af%e5%a2%83%e4%b8%8e%e8%8a%82%e7%82%b9%e8%bf%90%e7%ae%97%e7%9a%84%e5%80%bc" target="_blank" title="Share on LinkedIn">
          <i class="iconfont icon-linkedin"></i>
        </a>
        
      
      
        
      
        
      

          

          

          
        <a href="//www.douban.com/recommend/?url=https%3a%2f%2ffantasyplayer.link%2fprogram%2f%25E8%2587%25AA%25E5%2588%25B6%25E8%2584%259A%25E6%259C%25AC%25E8%25AF%25AD%25E8%25A8%25803.1-%25E7%258E%25AF%25E5%25A2%2583%25E4%25B8%258E%25E8%258A%2582%25E7%2582%25B9%25E8%25BF%2590%25E7%25AE%2597%25E7%259A%2584%25E5%2580%25BC%2f&amp;title=%e8%87%aa%e5%88%b6%e8%84%9a%e6%9c%ac%e8%af%ad%e8%a8%80%5b3.1%5d%20%e7%8e%af%e5%a2%83%e4%b8%8e%e8%8a%82%e7%82%b9%e8%bf%90%e7%ae%97%e7%9a%84%e5%80%bc" target="_blank" title="Share on Douban ">
            <i class="iconfont icon-douban"></i>
          </a>
          

          
</span>
                
            </p>

             
            <p class="copyright-item">
                Released under <a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a>
            </p>
            
    </div>

  
    <div class="post-tags">
        
        <section>
                <a href="javascript:window.history.back();">Back</a></span> · 
                <span><a href="https://fantasyplayer.link/">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://fantasyplayer.link/program/%E8%87%AA%E5%88%B6%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%802-%E7%B1%BB%E5%9E%8B%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9%E7%9A%84%E4%BB%8B%E7%BB%8D/" class="prev" rel="prev" title="自制脚本语言[2] 类型相关内容的介绍"><i class="iconfont icon-dajiantou"></i>&nbsp;自制脚本语言[2] 类型相关内容的介绍</a>
         
        
        <a href="https://fantasyplayer.link/program/%E8%87%AA%E5%88%B6%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%803.2-%E6%8A%BD%E8%B1%A1%E8%AF%AD%E6%B3%95%E6%A0%91%E7%9A%84%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/" class="next" rel="next" title="自制脚本语言[3.2]抽象语法树的简单介绍">自制脚本语言[3.2]抽象语法树的简单介绍&nbsp;<i class="iconfont icon-xiaojiantou"></i></a>
        
    </div>

    <div class="post-comment">
          
          
    <script src="https://utteranc.es/client.js"
            repo="Aincvy/aincvy.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

 

          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2020 - 2021</span>
        
         
            <span class="author" itemprop="copyrightHolder"><a href="https://fantasyplayer.link/">hideDragon</a> | </span>
         

		  <span>Crafted with ❤️ by <a href="https://github.com/Fastbyte01/KeepIt" target="_blank" rel="external nofollow noopener noreffer">KeepIt</a> & <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a></span>
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  







     </div>
  </body>
</html>
