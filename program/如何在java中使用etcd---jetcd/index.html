<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>如何在java中使用etcd   Jetcd - Fanstasy Player / 幻想系玩家</title><meta name="author" content="Aincvy">
<meta name="description" content="主要内容etcd 的特点KV 数据库， github 描述为： Distributed reliable key-value store for the most critical data of a distributed system 较为轻量， 和etcd交互的时候就是 操作（查询，设置，删除，监听）一个 字符串的 键值对 etcd 支持集群 但是笔者没有使用过。 每个KEY可以设置TTL， 并且存在 mod revision, 即修改版本号。 应用场景服务注册与发现 一些读者可能觉得nacos 比较好， 因为它可以以一个非常小的编码操作来实现这个功能。 那么笔者认为可以继续这样使用， 没必要一定要换到etcd。 笔者没有选择 nacos 的原因是因为笔者觉得 nacos 可能比较庞大， 笔者想引入一个轻量级的库。 笔者实现的思路是： 每个服务器上报自己的信息到etcd上。 KEY的格式是： /servers/TYPE/ID 上传间隔60秒， KEY的过期时间为65秒 只有当前服务器自己会上传信息到这些KEY， 别的服务器会拉取这些KEY的信息， 但是不会修改。 网关服务器使用 key prefix 来查询其他所有在线的服务器， 并尝试连接他们。 登录服使用 key prefix 来查询其他所有的网关服务器， 并根据网关在线人数 进行负载均衡。 配置表读取和热更新 配置表的KEY格式为： /config/GROUP/CONFIG_FILENAME 突然发现， 服务器的KEY也可以把GROUP带上 GROUP是服务器分组， 当多个服务器需要使用同一个etcd的时候 可以使用GROUP 进行分组。 配置表数据拉取到之后， 将这个KEY的 mod revision 记录一下。 定时轮询一下etcd ， 或者使用 WatchClient 来监视一下KEY， 如果key被修改了 就进行数据更新。 如果轮询的话，可以对比mod revision 代码示例1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 @Data public static class ServerRunningInfo { private int id; private int onlineCount; private String group = &#34;test&#34;; private String host; private int port; private String uuid; } public static ByteSequence seq(String str) { return ByteSequence.from(str, StandardCharsets.UTF_8); } public static void main(String[] args) { ObjectMapper objectMapper = new ObjectMapper(); Client client = Client.builder().endpoints(&#34;http://127.0.0.1:2379&#34;) .password(seq(&#34;123456&#34;)).build(); KV kvClient = client.getKVClient(); var option = GetOption.builder().isPrefix(true).build(); kvClient.get(seq(&#34;/servers/Fight/&#34;), option).thenAccept(r -&gt; { if (r.getCount() &lt;= 0) { return; } for (KeyValue kv : r.getKvs()) { long oldModRevision = 1; // 应该保存在某处， 在此地获取 if (kv.getModRevision() == oldModRevision) { continue; } try { ServerRunningInfo runningInfo = objectMapper.readValue(kv.getValue().getBytes(), ServerRunningInfo.class); // connect to server or some thing System.out.println(runningInfo); oldModRevision = kv.getModRevision(); } catch (StreamReadException e) { e.printStackTrace(); } catch (DatabindException e) { e.printStackTrace(); } catch (IOException e) { e.printStackTrace(); } } }).join(); // 当前主线程没其他事情的时候， 如果这里不 join的话， 程序就会自动退出了。 Lease leaseClient = client.getLeaseClient(); var leaseId = leaseClient.grant(65).join().getID(); // 设置65秒的 TTL // 模拟放置服务器信息， 假设目前是网关服务器 ServerRunningInfo myInfo = new ServerRunningInfo(); try { PutOption putOption = PutOption.builder().withLeaseId(leaseId).build(); kvClient.put(seq(&#34;/servers/Gate/&#34; &#43; myInfo.getId()), ByteSequence.from(objectMapper.writeValueAsBytes(myInfo)), putOption) .join(); // 如果主线程或者说当前线程有其他任务的话， 就不需要join } catch (JsonProcessingException e) { e.printStackTrace(); } Watch watchClient = client.getWatchClient(); watchClient.watch(seq(&#34;/config/test/A.json&#34;), r -&gt; { for (WatchEvent e : r.getEvents()) { KeyValue keyValue = e.getKeyValue(); long oldModRevision = 1; // 应该保存在某处， 在此地获取 if (keyValue.getModRevision() == oldModRevision) { continue; } var jsonContent = keyValue.getValue().toString(); // do something with jsonContent ... oldModRevision = keyValue.getModRevision(); } }); } 可以看到， 总共的代码行数也不是特别多， 但是需要的功能都可以实现。
"><meta name="keywords" content='java'>
  <meta itemprop="name" content="如何在java中使用etcd   Jetcd">
  <meta itemprop="description" content="主要内容etcd 的特点KV 数据库， github 描述为： Distributed reliable key-value store for the most critical data of a distributed system 较为轻量， 和etcd交互的时候就是 操作（查询，设置，删除，监听）一个 字符串的 键值对 etcd 支持集群 但是笔者没有使用过。 每个KEY可以设置TTL， 并且存在 mod revision, 即修改版本号。 应用场景服务注册与发现 一些读者可能觉得nacos 比较好， 因为它可以以一个非常小的编码操作来实现这个功能。 那么笔者认为可以继续这样使用， 没必要一定要换到etcd。 笔者没有选择 nacos 的原因是因为笔者觉得 nacos 可能比较庞大， 笔者想引入一个轻量级的库。 笔者实现的思路是： 每个服务器上报自己的信息到etcd上。 KEY的格式是： /servers/TYPE/ID 上传间隔60秒， KEY的过期时间为65秒 只有当前服务器自己会上传信息到这些KEY， 别的服务器会拉取这些KEY的信息， 但是不会修改。 网关服务器使用 key prefix 来查询其他所有在线的服务器， 并尝试连接他们。 登录服使用 key prefix 来查询其他所有的网关服务器， 并根据网关在线人数 进行负载均衡。 配置表读取和热更新 配置表的KEY格式为： /config/GROUP/CONFIG_FILENAME 突然发现， 服务器的KEY也可以把GROUP带上 GROUP是服务器分组， 当多个服务器需要使用同一个etcd的时候 可以使用GROUP 进行分组。 配置表数据拉取到之后， 将这个KEY的 mod revision 记录一下。 定时轮询一下etcd ， 或者使用 WatchClient 来监视一下KEY， 如果key被修改了 就进行数据更新。 如果轮询的话，可以对比mod revision 代码示例1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 @Data public static class ServerRunningInfo { private int id; private int onlineCount; private String group = &#34;test&#34;; private String host; private int port; private String uuid; } public static ByteSequence seq(String str) { return ByteSequence.from(str, StandardCharsets.UTF_8); } public static void main(String[] args) { ObjectMapper objectMapper = new ObjectMapper(); Client client = Client.builder().endpoints(&#34;http://127.0.0.1:2379&#34;) .password(seq(&#34;123456&#34;)).build(); KV kvClient = client.getKVClient(); var option = GetOption.builder().isPrefix(true).build(); kvClient.get(seq(&#34;/servers/Fight/&#34;), option).thenAccept(r -&gt; { if (r.getCount() &lt;= 0) { return; } for (KeyValue kv : r.getKvs()) { long oldModRevision = 1; // 应该保存在某处， 在此地获取 if (kv.getModRevision() == oldModRevision) { continue; } try { ServerRunningInfo runningInfo = objectMapper.readValue(kv.getValue().getBytes(), ServerRunningInfo.class); // connect to server or some thing System.out.println(runningInfo); oldModRevision = kv.getModRevision(); } catch (StreamReadException e) { e.printStackTrace(); } catch (DatabindException e) { e.printStackTrace(); } catch (IOException e) { e.printStackTrace(); } } }).join(); // 当前主线程没其他事情的时候， 如果这里不 join的话， 程序就会自动退出了。 Lease leaseClient = client.getLeaseClient(); var leaseId = leaseClient.grant(65).join().getID(); // 设置65秒的 TTL // 模拟放置服务器信息， 假设目前是网关服务器 ServerRunningInfo myInfo = new ServerRunningInfo(); try { PutOption putOption = PutOption.builder().withLeaseId(leaseId).build(); kvClient.put(seq(&#34;/servers/Gate/&#34; &#43; myInfo.getId()), ByteSequence.from(objectMapper.writeValueAsBytes(myInfo)), putOption) .join(); // 如果主线程或者说当前线程有其他任务的话， 就不需要join } catch (JsonProcessingException e) { e.printStackTrace(); } Watch watchClient = client.getWatchClient(); watchClient.watch(seq(&#34;/config/test/A.json&#34;), r -&gt; { for (WatchEvent e : r.getEvents()) { KeyValue keyValue = e.getKeyValue(); long oldModRevision = 1; // 应该保存在某处， 在此地获取 if (keyValue.getModRevision() == oldModRevision) { continue; } var jsonContent = keyValue.getValue().toString(); // do something with jsonContent ... oldModRevision = keyValue.getModRevision(); } }); } 可以看到， 总共的代码行数也不是特别多， 但是需要的功能都可以实现。">
  <meta itemprop="datePublished" content="2024-05-26T11:46:41+08:00">
  <meta itemprop="dateModified" content="2024-06-10T16:55:59+08:00">
  <meta itemprop="wordCount" content="1045">
  <meta itemprop="image" content="https://fantasyplayer.link/logo.png">
  <meta itemprop="keywords" content="Java"><meta property="og:url" content="https://fantasyplayer.link/program/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8etcd---jetcd/">
  <meta property="og:site_name" content="Fanstasy Player / 幻想系玩家">
  <meta property="og:title" content="如何在java中使用etcd   Jetcd">
  <meta property="og:description" content="主要内容etcd 的特点KV 数据库， github 描述为： Distributed reliable key-value store for the most critical data of a distributed system 较为轻量， 和etcd交互的时候就是 操作（查询，设置，删除，监听）一个 字符串的 键值对 etcd 支持集群 但是笔者没有使用过。 每个KEY可以设置TTL， 并且存在 mod revision, 即修改版本号。 应用场景服务注册与发现 一些读者可能觉得nacos 比较好， 因为它可以以一个非常小的编码操作来实现这个功能。 那么笔者认为可以继续这样使用， 没必要一定要换到etcd。 笔者没有选择 nacos 的原因是因为笔者觉得 nacos 可能比较庞大， 笔者想引入一个轻量级的库。 笔者实现的思路是： 每个服务器上报自己的信息到etcd上。 KEY的格式是： /servers/TYPE/ID 上传间隔60秒， KEY的过期时间为65秒 只有当前服务器自己会上传信息到这些KEY， 别的服务器会拉取这些KEY的信息， 但是不会修改。 网关服务器使用 key prefix 来查询其他所有在线的服务器， 并尝试连接他们。 登录服使用 key prefix 来查询其他所有的网关服务器， 并根据网关在线人数 进行负载均衡。 配置表读取和热更新 配置表的KEY格式为： /config/GROUP/CONFIG_FILENAME 突然发现， 服务器的KEY也可以把GROUP带上 GROUP是服务器分组， 当多个服务器需要使用同一个etcd的时候 可以使用GROUP 进行分组。 配置表数据拉取到之后， 将这个KEY的 mod revision 记录一下。 定时轮询一下etcd ， 或者使用 WatchClient 来监视一下KEY， 如果key被修改了 就进行数据更新。 如果轮询的话，可以对比mod revision 代码示例1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 @Data public static class ServerRunningInfo { private int id; private int onlineCount; private String group = &#34;test&#34;; private String host; private int port; private String uuid; } public static ByteSequence seq(String str) { return ByteSequence.from(str, StandardCharsets.UTF_8); } public static void main(String[] args) { ObjectMapper objectMapper = new ObjectMapper(); Client client = Client.builder().endpoints(&#34;http://127.0.0.1:2379&#34;) .password(seq(&#34;123456&#34;)).build(); KV kvClient = client.getKVClient(); var option = GetOption.builder().isPrefix(true).build(); kvClient.get(seq(&#34;/servers/Fight/&#34;), option).thenAccept(r -&gt; { if (r.getCount() &lt;= 0) { return; } for (KeyValue kv : r.getKvs()) { long oldModRevision = 1; // 应该保存在某处， 在此地获取 if (kv.getModRevision() == oldModRevision) { continue; } try { ServerRunningInfo runningInfo = objectMapper.readValue(kv.getValue().getBytes(), ServerRunningInfo.class); // connect to server or some thing System.out.println(runningInfo); oldModRevision = kv.getModRevision(); } catch (StreamReadException e) { e.printStackTrace(); } catch (DatabindException e) { e.printStackTrace(); } catch (IOException e) { e.printStackTrace(); } } }).join(); // 当前主线程没其他事情的时候， 如果这里不 join的话， 程序就会自动退出了。 Lease leaseClient = client.getLeaseClient(); var leaseId = leaseClient.grant(65).join().getID(); // 设置65秒的 TTL // 模拟放置服务器信息， 假设目前是网关服务器 ServerRunningInfo myInfo = new ServerRunningInfo(); try { PutOption putOption = PutOption.builder().withLeaseId(leaseId).build(); kvClient.put(seq(&#34;/servers/Gate/&#34; &#43; myInfo.getId()), ByteSequence.from(objectMapper.writeValueAsBytes(myInfo)), putOption) .join(); // 如果主线程或者说当前线程有其他任务的话， 就不需要join } catch (JsonProcessingException e) { e.printStackTrace(); } Watch watchClient = client.getWatchClient(); watchClient.watch(seq(&#34;/config/test/A.json&#34;), r -&gt; { for (WatchEvent e : r.getEvents()) { KeyValue keyValue = e.getKeyValue(); long oldModRevision = 1; // 应该保存在某处， 在此地获取 if (keyValue.getModRevision() == oldModRevision) { continue; } var jsonContent = keyValue.getValue().toString(); // do something with jsonContent ... oldModRevision = keyValue.getModRevision(); } }); } 可以看到， 总共的代码行数也不是特别多， 但是需要的功能都可以实现。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="program">
    <meta property="article:published_time" content="2024-05-26T11:46:41+08:00">
    <meta property="article:modified_time" content="2024-06-10T16:55:59+08:00">
    <meta property="article:tag" content="Java">
    <meta property="og:image" content="https://fantasyplayer.link/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://fantasyplayer.link/logo.png">
  <meta name="twitter:title" content="如何在java中使用etcd   Jetcd">
  <meta name="twitter:description" content="主要内容etcd 的特点KV 数据库， github 描述为： Distributed reliable key-value store for the most critical data of a distributed system 较为轻量， 和etcd交互的时候就是 操作（查询，设置，删除，监听）一个 字符串的 键值对 etcd 支持集群 但是笔者没有使用过。 每个KEY可以设置TTL， 并且存在 mod revision, 即修改版本号。 应用场景服务注册与发现 一些读者可能觉得nacos 比较好， 因为它可以以一个非常小的编码操作来实现这个功能。 那么笔者认为可以继续这样使用， 没必要一定要换到etcd。 笔者没有选择 nacos 的原因是因为笔者觉得 nacos 可能比较庞大， 笔者想引入一个轻量级的库。 笔者实现的思路是： 每个服务器上报自己的信息到etcd上。 KEY的格式是： /servers/TYPE/ID 上传间隔60秒， KEY的过期时间为65秒 只有当前服务器自己会上传信息到这些KEY， 别的服务器会拉取这些KEY的信息， 但是不会修改。 网关服务器使用 key prefix 来查询其他所有在线的服务器， 并尝试连接他们。 登录服使用 key prefix 来查询其他所有的网关服务器， 并根据网关在线人数 进行负载均衡。 配置表读取和热更新 配置表的KEY格式为： /config/GROUP/CONFIG_FILENAME 突然发现， 服务器的KEY也可以把GROUP带上 GROUP是服务器分组， 当多个服务器需要使用同一个etcd的时候 可以使用GROUP 进行分组。 配置表数据拉取到之后， 将这个KEY的 mod revision 记录一下。 定时轮询一下etcd ， 或者使用 WatchClient 来监视一下KEY， 如果key被修改了 就进行数据更新。 如果轮询的话，可以对比mod revision 代码示例1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 @Data public static class ServerRunningInfo { private int id; private int onlineCount; private String group = &#34;test&#34;; private String host; private int port; private String uuid; } public static ByteSequence seq(String str) { return ByteSequence.from(str, StandardCharsets.UTF_8); } public static void main(String[] args) { ObjectMapper objectMapper = new ObjectMapper(); Client client = Client.builder().endpoints(&#34;http://127.0.0.1:2379&#34;) .password(seq(&#34;123456&#34;)).build(); KV kvClient = client.getKVClient(); var option = GetOption.builder().isPrefix(true).build(); kvClient.get(seq(&#34;/servers/Fight/&#34;), option).thenAccept(r -&gt; { if (r.getCount() &lt;= 0) { return; } for (KeyValue kv : r.getKvs()) { long oldModRevision = 1; // 应该保存在某处， 在此地获取 if (kv.getModRevision() == oldModRevision) { continue; } try { ServerRunningInfo runningInfo = objectMapper.readValue(kv.getValue().getBytes(), ServerRunningInfo.class); // connect to server or some thing System.out.println(runningInfo); oldModRevision = kv.getModRevision(); } catch (StreamReadException e) { e.printStackTrace(); } catch (DatabindException e) { e.printStackTrace(); } catch (IOException e) { e.printStackTrace(); } } }).join(); // 当前主线程没其他事情的时候， 如果这里不 join的话， 程序就会自动退出了。 Lease leaseClient = client.getLeaseClient(); var leaseId = leaseClient.grant(65).join().getID(); // 设置65秒的 TTL // 模拟放置服务器信息， 假设目前是网关服务器 ServerRunningInfo myInfo = new ServerRunningInfo(); try { PutOption putOption = PutOption.builder().withLeaseId(leaseId).build(); kvClient.put(seq(&#34;/servers/Gate/&#34; &#43; myInfo.getId()), ByteSequence.from(objectMapper.writeValueAsBytes(myInfo)), putOption) .join(); // 如果主线程或者说当前线程有其他任务的话， 就不需要join } catch (JsonProcessingException e) { e.printStackTrace(); } Watch watchClient = client.getWatchClient(); watchClient.watch(seq(&#34;/config/test/A.json&#34;), r -&gt; { for (WatchEvent e : r.getEvents()) { KeyValue keyValue = e.getKeyValue(); long oldModRevision = 1; // 应该保存在某处， 在此地获取 if (keyValue.getModRevision() == oldModRevision) { continue; } var jsonContent = keyValue.getValue().toString(); // do something with jsonContent ... oldModRevision = keyValue.getModRevision(); } }); } 可以看到， 总共的代码行数也不是特别多， 但是需要的功能都可以实现。">
      <meta name="twitter:site" content="@Aincvy">
<meta name="twitter:creator" content="@Aincvy" /><meta name="application-name" content="Fanstasy Player / 幻想系玩家">
<meta name="apple-mobile-web-app-title" content="Fanstasy Player / 幻想系玩家"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" type="text/html" href="https://fantasyplayer.link/program/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8etcd---jetcd/" title="如何在java中使用etcd   Jetcd - Fanstasy Player / 幻想系玩家" /><link rel="prev" type="text/html" href="https://fantasyplayer.link/program/%E5%9C%A8%E6%9D%83%E9%87%8D%E9%9A%8F%E6%9C%BA%E4%B8%AD%E4%BD%BF%E7%94%A8%E9%81%AE%E7%BD%A9%E4%BD%8D%E6%9D%A5%E5%AE%9E%E7%8E%B0%E5%8E%BB%E9%87%8D/" title="在权重随机中使用遮罩位来实现去重" /><link rel="next" type="text/html" href="https://fantasyplayer.link/program/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8ebean---%E4%B8%80%E4%B8%AAmysql-%E6%93%8D%E4%BD%9C%E5%BA%93/" title="如何在java中使用ebean" /><link rel="alternate" type="text/markdown" href="https://fantasyplayer.link/program/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8etcd---jetcd/index.md" title="如何在java中使用etcd   Jetcd - Fanstasy Player / 幻想系玩家"><link rel="stylesheet" href="/css/style.min.a2aa282e08caced70722685b6330357696ad219c96160cda1abc0b46c9b713a4.css" integrity="sha256-oqooLgjKztcHImhbYzA1dpatIZyWFgzaGrwLRsm3E6Q="><link rel="preload" href="/lib/fontawesome-free/all.min.534c7ac9d4ef5cb29828c4d571a05399871edec50f5b8c72372379bed20fb033.css" integrity="sha256-U0x6ydTvXLKYKMTVcaBTmYce3sUPW4xyNyN5vtIPsDM=" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.534c7ac9d4ef5cb29828c4d571a05399871edec50f5b8c72372379bed20fb033.css" integrity="sha256-U0x6ydTvXLKYKMTVcaBTmYce3sUPW4xyNyN5vtIPsDM="></noscript><link rel="preload" href="/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css" integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8=" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.5fbaeb9f8e25d7e0143bae61d4b1802c16ce7390b96ceb2d498b0d96ff4c853f.css" integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8="></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "如何在java中使用etcd   Jetcd",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https:\/\/fantasyplayer.link\/program\/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8etcd---jetcd\/"
    },"genre": "posts","keywords": "java","wordcount":  1045 ,
    "url": "https:\/\/fantasyplayer.link\/program\/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8etcd---jetcd\/","datePublished": "2024-05-26T11:46:41+08:00","dateModified": "2024-06-10T16:55:59+08:00","publisher": {
      "@type": "Organization",
      "name": ""},"author": {
        "@type": "Person",
        "name": "Aincvy"
      },"description": ""
  }
  </script><script src="/js/head/color-scheme.min.31d8a7cb672f3f9f8d8e93ac3bcccaaab5ae06187a716d06f89b4b7ca33de06a.js" integrity="sha256-Mdiny2cvP5+NjpOsO8zKqrWuBhh6cW0G+JtLfKM94Go="></script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/" title="Fanstasy Player / 幻想系玩家"><img loading="lazy" src="/images/3.jpeg" alt="Fanstasy Player / 幻想系玩家" data-title="Fanstasy Player / 幻想系玩家" width="26" height="26" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-text">Fanstasy Player / 幻想系玩家</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a class="menu-link" href="/program/">Program</a></li><li class="menu-item">
              <a class="menu-link" href="/periphery/">Periphery</a></li><li class="menu-item">
              <a class="menu-link" href="/series/">Series</a></li><li class="menu-item">
              <a class="menu-link" href="/caprice/">Caprice</a></li><li class="menu-item">
              <a class="menu-link" href="/posts/">Posts</a></li><li class="menu-item">
              <a class="menu-link" href="/about">About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容……" id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/" title="Fanstasy Player / 幻想系玩家"><img loading="lazy" src="/images/3.jpeg" alt="Fanstasy Player / 幻想系玩家" data-title="Fanstasy Player / 幻想系玩家" width="26" height="26" class="logo" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/><span class="header-title-text">Fanstasy Player / 幻想系玩家</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容……" id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li class="menu-item"><a class="menu-link" href="/program/">Program</a></li><li class="menu-item"><a class="menu-link" href="/periphery/">Periphery</a></li><li class="menu-item"><a class="menu-link" href="/series/">Series</a></li><li class="menu-item"><a class="menu-link" href="/caprice/">Caprice</a></li><li class="menu-item"><a class="menu-link" href="/posts/">Posts</a></li><li class="menu-item"><a class="menu-link" href="/about">About</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title="切换主题"><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span></li>
      </ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><nav aria-label="breadcrumb" class="breadcrumb-container sticky">
    <ol class="breadcrumb"><li class="breadcrumb-item" data-separator="/"><a href="/program/" title="Programs">Programs</a></li><li class="breadcrumb-item active" data-separator="/" aria-current="page">如何在java中使用etcd   Jetcd</li>
    </ol>
  </nav><main class="container"><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label="合集"></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX"><span>如何在java中使用etcd   Jetcd</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      Aincvy</span></span></div><div class="post-meta-line"><span title="发布于 2024-05-26 11:46:41"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden="true"></i><time datetime="2024-05-26">2024-05-26</time></span>&nbsp;<span title="更新于 2024-06-10 16:55:59"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden="true"></i><time datetime="2024-06-10">2024-06-10</time></span>&nbsp;<span title="1045 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden="true"></i>约 1100 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden="true"></i>预计阅读 3 分钟</span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" data-kept="false">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right" aria-hidden="true"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#主要内容">主要内容</a>
      <ul>
        <li><a href="#etcd-的特点">etcd 的特点</a></li>
        <li><a href="#应用场景">应用场景</a></li>
        <li><a href="#代码示例">代码示例</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div class="content" id="content"><h2 id="主要内容" class="heading-element"><span>主要内容</span>
  <a href="#%e4%b8%bb%e8%a6%81%e5%86%85%e5%ae%b9" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h2><h3 id="etcd-的特点" class="heading-element"><span>etcd 的特点</span>
  <a href="#etcd-%e7%9a%84%e7%89%b9%e7%82%b9" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ul>
<li>KV 数据库， github 描述为：  Distributed reliable key-value store for the most critical data of a distributed system</li>
<li>较为轻量， 和etcd交互的时候就是 操作（<em>查询，设置，删除，监听</em>）一个 字符串的 键值对</li>
<li>etcd 支持集群  <em>但是笔者没有使用过。</em></li>
<li>每个KEY可以设置TTL，  并且存在 mod revision, 即修改版本号。</li>
</ul>
<h3 id="应用场景" class="heading-element"><span>应用场景</span>
  <a href="#%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><ul>
<li>服务注册与发现
<ul>
<li>一些读者可能觉得nacos 比较好， 因为它可以以一个非常小的编码操作来实现这个功能。  那么笔者认为可以继续这样使用， 没必要一定要换到etcd。</li>
<li>笔者没有选择 nacos 的原因是因为笔者觉得 nacos 可能比较庞大， 笔者想引入一个轻量级的库。</li>
<li>笔者实现的思路是：
<ul>
<li>每个服务器上报自己的信息到etcd上。
<ul>
<li>KEY的格式是： <code>/servers/TYPE/ID</code></li>
<li>上传间隔60秒， KEY的过期时间为65秒</li>
<li>只有当前服务器自己会上传信息到这些KEY， 别的服务器会拉取这些KEY的信息， 但是不会修改。</li>
</ul>
</li>
<li>网关服务器使用 key prefix 来查询其他所有在线的服务器， 并尝试连接他们。</li>
<li>登录服使用 key prefix 来查询其他所有的网关服务器， 并根据网关在线人数 进行负载均衡。</li>
</ul>
</li>
</ul>
</li>
<li>配置表读取和热更新
<ul>
<li>配置表的KEY格式为： <code>/config/GROUP/CONFIG_FILENAME</code>     <em>突然发现， 服务器的KEY也可以把GROUP带上</em>
<ul>
<li>GROUP是服务器分组， 当多个服务器需要使用同一个etcd的时候 可以使用GROUP 进行分组。</li>
</ul>
</li>
<li>配置表数据拉取到之后， 将这个KEY的 mod revision 记录一下。</li>
<li>定时轮询一下etcd ， 或者使用 WatchClient 来监视一下KEY，  如果key被修改了 就进行数据更新。   <em>如果轮询的话，可以对比mod revision</em></li>
</ul>
</li>
</ul>
<h3 id="代码示例" class="heading-element"><span>代码示例</span>
  <a href="#%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b" class="heading-mark">
    <svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg>
  </a>
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ServerRunningInfo</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">onlineCount</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;test&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">host</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">uuid</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ByteSequence</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ByteSequence</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Client</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Client</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">endpoints</span><span class="p">(</span><span class="s">&#34;http://127.0.0.1:2379&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">password</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="s">&#34;123456&#34;</span><span class="p">)).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">KV</span><span class="w"> </span><span class="n">kvClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">getKVClient</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetOption</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">isPrefix</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">kvClient</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="s">&#34;/servers/Fight/&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">option</span><span class="p">).</span><span class="na">thenAccept</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="na">getCount</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">KeyValue</span><span class="w"> </span><span class="n">kv</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="na">getKvs</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kt">long</span><span class="w"> </span><span class="n">oldModRevision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">      </span><span class="c1">// 应该保存在某处， 在此地获取</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">kv</span><span class="p">.</span><span class="na">getModRevision</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">oldModRevision</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">continue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">ServerRunningInfo</span><span class="w"> </span><span class="n">runningInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">.</span><span class="na">readValue</span><span class="p">(</span><span class="n">kv</span><span class="p">.</span><span class="na">getValue</span><span class="p">().</span><span class="na">getBytes</span><span class="p">(),</span><span class="w"> </span><span class="n">ServerRunningInfo</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="c1">// connect to server or some thing </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">runningInfo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">oldModRevision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="na">getModRevision</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">StreamReadException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">DatabindException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}).</span><span class="na">join</span><span class="p">();</span><span class="w">    </span><span class="c1">// 当前主线程没其他事情的时候， 如果这里不 join的话， 程序就会自动退出了。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Lease</span><span class="w"> </span><span class="n">leaseClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">getLeaseClient</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">leaseId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leaseClient</span><span class="p">.</span><span class="na">grant</span><span class="p">(</span><span class="n">65</span><span class="p">).</span><span class="na">join</span><span class="p">().</span><span class="na">getID</span><span class="p">();</span><span class="w">      </span><span class="c1">// 设置65秒的 TTL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 模拟放置服务器信息， 假设目前是网关服务器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ServerRunningInfo</span><span class="w"> </span><span class="n">myInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ServerRunningInfo</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">PutOption</span><span class="w"> </span><span class="n">putOption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PutOption</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">withLeaseId</span><span class="p">(</span><span class="n">leaseId</span><span class="p">).</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">kvClient</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="s">&#34;/servers/Gate/&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">myInfo</span><span class="p">.</span><span class="na">getId</span><span class="p">()),</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">ByteSequence</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">objectMapper</span><span class="p">.</span><span class="na">writeValueAsBytes</span><span class="p">(</span><span class="n">myInfo</span><span class="p">)),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">putOption</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">join</span><span class="p">();</span><span class="w">    </span><span class="c1">// 如果主线程或者说当前线程有其他任务的话， 就不需要join </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">JsonProcessingException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Watch</span><span class="w"> </span><span class="n">watchClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="na">getWatchClient</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">watchClient</span><span class="p">.</span><span class="na">watch</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="s">&#34;/config/test/A.json&#34;</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">WatchEvent</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="na">getEvents</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">KeyValue</span><span class="w"> </span><span class="n">keyValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getKeyValue</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kt">long</span><span class="w"> </span><span class="n">oldModRevision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">      </span><span class="c1">// 应该保存在某处， 在此地获取</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">keyValue</span><span class="p">.</span><span class="na">getModRevision</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">oldModRevision</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="k">continue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">var</span><span class="w"> </span><span class="n">jsonContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyValue</span><span class="p">.</span><span class="na">getValue</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c1">// do something with jsonContent ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">oldModRevision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyValue</span><span class="p">.</span><span class="na">getModRevision</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到， 总共的代码行数也不是特别多， 但是需要的功能都可以实现。</p>
<p>自己实现的好处是减少黑盒占比， 出现了问题的时候方便解决。</p>
</div><div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title="更新于 2024-06-10 16:55:59">更新于 2024-06-10&nbsp;</span>
      </div><div class="post-info-license">
            <span>Released under <a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
          </div></div><div class="post-info-line">
        <div class="post-info-md"></div>
        <div class="post-info-share">
          <span><a href="javascript:void(0);" title="分享到 X" data-sharer="twitter" data-url="https://fantasyplayer.link/program/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8etcd---jetcd/" data-title="如何在java中使用etcd   Jetcd" data-via="Aincvy" data-hashtags="java"><i class="fa-brands fa-x-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://fantasyplayer.link/program/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8etcd---jetcd/" data-hashtag="java"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 WhatsApp" data-sharer="whatsapp" data-url="https://fantasyplayer.link/program/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8etcd---jetcd/" data-title="如何在java中使用etcd   Jetcd" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://fantasyplayer.link/program/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8etcd---jetcd/" data-title="如何在java中使用etcd   Jetcd"><svg class="icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LINE</title><path d="M19.365 9.863c.349.0.63.285.63.631.0.345-.281.63-.63.63H17.61v1.125h1.755c.349.0.63.283.63.63.0.344-.281.629-.63.629h-2.386c-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346.0.627.285.627.63.0.349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211.0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346.0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195.0.375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345.0.63.285.63.63v4.771zm-5.741.0c0 .344-.282.629-.631.629-.345.0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346.0.628.285.628.63v4.771zm-2.466.629H4.917c-.345.0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348.0.63.285.63.63v4.141h1.756c.348.0.629.283.629.63.0.344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943.0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://fantasyplayer.link/program/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8etcd---jetcd/" data-title="如何在java中使用etcd   Jetcd"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Myspace" data-sharer="myspace" data-url="https://fantasyplayer.link/program/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8etcd---jetcd/" data-title="如何在java中使用etcd   Jetcd" data-description=""><svg class="icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Myspace</title><path d="M19.802 12.274A3.811 3.811.0 0023.62 8.47c0-2.101-1.71-3.795-3.818-3.795a3.816 3.816.0 00-3.818 3.81 3.817 3.817.0 003.818 3.811zm-8.602.705a3.43 3.43.0 003.435-3.424A3.43 3.43.0 0011.2 6.13 3.44 3.44.0 007.764 9.566 3.436 3.436.0 0011.2 13zm-7.8.635c1.71.0 3.093-1.38 3.093-3.081.0-1.704-1.395-3.084-3.105-3.084A3.086 3.086.0 00.3 10.539c0 1.7 1.387 3.078 3.095 3.078zm0 .705c-1.96.0-3.4 1.717-3.4 3.495v1.196c0 .17.138.31.31.31h6.18a.31.31.0 00.309-.31v-1.196c0-1.779-1.437-3.5-3.398-3.5zm7.8-.56c-2.18.0-3.78 1.915-3.78 3.891v1.331c0 .188.156.344.345.344h6.87a.344.344.0 00.342-.344V17.65c0-1.976-1.598-3.891-3.777-3.891zm8.602-.617c-2.422.0-4.197 2.126-4.197 4.323v1.477c0 .21.172.381.382.381h7.63c.21.0.383-.171.383-.381v-1.477c-.001-2.197-1.776-4.323-4.198-4.323z"/></svg></a>
  <a href="javascript:void(0);" title="分享到 Blogger" data-sharer="blogger" data-url="https://fantasyplayer.link/program/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8etcd---jetcd/" data-title="如何在java中使用etcd   Jetcd" data-description=""><i class="fa-brands fa-blogger fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://fantasyplayer.link/program/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8etcd---jetcd/" data-title="如何在java中使用etcd   Jetcd"><i class="fa-brands fa-evernote fa-fw" aria-hidden="true"></i></a>
  </span>
        </div>
      </div></div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href="/tags/java/" class="post-tag" title="标签 - Java">Java</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
    </section>
  </div><div class="post-nav"><a href="/program/%E5%9C%A8%E6%9D%83%E9%87%8D%E9%9A%8F%E6%9C%BA%E4%B8%AD%E4%BD%BF%E7%94%A8%E9%81%AE%E7%BD%A9%E4%BD%8D%E6%9D%A5%E5%AE%9E%E7%8E%B0%E5%8E%BB%E9%87%8D/" class="post-nav-item" rel="prev" title="在权重随机中使用遮罩位来实现去重"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>在权重随机中使用遮罩位来实现去重</a><a href="/program/%E5%A6%82%E4%BD%95%E5%9C%A8java%E4%B8%AD%E4%BD%BF%E7%94%A8ebean---%E4%B8%80%E4%B8%AAmysql-%E6%93%8D%E4%BD%9C%E5%BA%93/" class="post-nav-item" rel="next" title="如何在java中使用ebean">如何在java中使用ebean<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="utterances" class="comment"></div><noscript>
        Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/" rel="external nofollow noopener noreferrer">Utterances</a>.
      </noscript></div></article>

  <aside class="toc" id="toc-auto" aria-label="目录"><h2 class="toc-title">目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden="true"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.138.0"><img class="hugo-icon" src="/images/hugo.min.svg" alt="Hugo logo" /> Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.3.15"><img class="fixit-icon" src="/images/fixit.min.svg" alt="FixIt logo" /> FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2020 - 2024</span><span class="author" itemprop="copyrightHolder">
              <a href="/">Aincvy</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div><div class="fixed-button view-comments d-none" role="button" aria-label="查看评论"><i class="fa-solid fa-comment fa-fw" aria-hidden="true"></i></div></div><div id="mask"></div><noscript>
    <div class="noscript-warning">该网站在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.120f067ebd6f322339e2ccccd7e87e334d7c7ea5b2bd553f325f2ae3c3ae6fe8.css" integrity="sha256-Eg8Gfr1vMiM54szM1+h+M018fqWyvVU/Ml8q48Oub+g="><link rel="preload" href="/lib/katex/katex.min.7fcad90fec5779332198a785f8ffb5af9cdf8d41a6fac42ff420bbb526d9c01b.css" integrity="sha256-f8rZD+xXeTMhmKeF+P+1r5zfjUGm+sQv9CC7tSbZwBs=" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/katex/katex.min.7fcad90fec5779332198a785f8ffb5af9cdf8d41a6fac42ff420bbb526d9c01b.css" integrity="sha256-f8rZD+xXeTMhmKeF+P+1r5zfjUGm+sQv9CC7tSbZwBs="></noscript><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.cd0d0b6e50ff01ff2f3a9a70d7cfb66a7c6cb9acf7a566325568be6d3bd31fc4.css" integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q="><script src="/lib/autocomplete/autocomplete.min.ae2da1bd62c6469ee27770ad1cddf2e8296d8a7f6d85b091463e5200c5e320af.js" integrity="sha256-ri2hvWLGRp7id3CtHN3y6Cltin9thbCRRj5SAMXjIK8=" defer></script><script src="/lib/lightgallery/lightgallery.min.fd89888c69a37f6850ff5718231f26bf502310de8489dc5111da0db5d9f51b57.js" integrity="sha256-/YmIjGmjf2hQ/1cYIx8mv1AjEN6EidxREdoNtdn1G1c=" defer></script><script src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.a502d6f402482d60810b3e6965bd06cac0290f5284a79037c90bece078ed29cd.js" integrity="sha256-pQLW9AJILWCBCz5pZb0GysApD1KEp5A3yQvs4HjtKc0=" defer></script><script src="/lib/lightgallery/plugins/zoom/lg-zoom.min.d26a9098ce778cc15f30cf87b310bd6850f4d6601b06dbde5205454058b8cbc3.js" integrity="sha256-0mqQmM53jMFfMM+HsxC9aFD01mAbBtveUgVFQFi4y8M=" defer></script><script src="/lib/sharer/sharer.min.ba5171a78670b031914e623431a33a3d73c1ea9897e552ba73bc2c2da7c777b9.js" integrity="sha256-ulFxp4ZwsDGRTmI0MaM6PXPB6piX5VK6c7wsLafHd7k=" async defer></script><script src="/lib/katex/katex.min.9f45307c5794ed247a0d095f3a62e52ef2215a67b2327203a7fd919959ae79d1.js" integrity="sha256-n0UwfFeU7SR6DQlfOmLlLvIhWmeyMnIDp/2RmVmuedE=" defer></script><script src="/lib/katex/auto-render.min.7b57d427ac6270677daf8d8380ded2cc73336f9149a167b8e1fe0d6ef66604ae.js" integrity="sha256-e1fUJ6xicGd9r42DgN7SzHMzb5FJoWe44f4NbvZmBK4=" defer></script><script src="/lib/katex/copy-tex.min.07770af90943a1de1a1010794bc78c6a7346d46d48fb63e35cc76ba76b827604.js" integrity="sha256-B3cK+QlDod4aEBB5S8eManNG1G1I+2PjXMdrp2uCdgQ=" defer></script><script src="/lib/katex/mhchem.min.f0ca03df194b8c3d6017ff455db6a0ef98857905663fa311a6cded788b15340b.js" integrity="sha256-8MoD3xlLjD1gF/9FXbag75iFeQVmP6MRps3teIsVNAs=" defer></script><script src="/lib/cookieconsent/cookieconsent.min.e55842a856a6d829feca3c3ad736c136b6c7549e9247274f78aa296259e06e24.js" integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":100},"comment":{"enable":true,"expired":false,"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"","lightTheme":"github-light","repo":"Aincvy/aincvy.github.io"}},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"enablePWA":true,"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50},"version":"v0.3.15"};</script><script src="/js/theme.min.ae7e4724d92ddcd99387ab308ff93769f5e1ffa46b7f473559433ac75ed3a132.js" integrity="sha256-rn5HJNkt3NmTh6swj/k3afXh/6Rrf0c1WUM6x17ToTI=" defer></script><script>
      window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
      gtag('config', 'G-P74XPSRPG3');
    </script><script src="https://www.googletagmanager.com/gtag/js?id=G-P74XPSRPG3" async></script></body>
</html>
