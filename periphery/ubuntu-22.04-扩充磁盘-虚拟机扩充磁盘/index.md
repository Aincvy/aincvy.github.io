# Ubuntu 22.04 扩充磁盘， 虚拟机扩充磁盘


## 主要内容

### 扩充磁盘

需求： 宿主机是debian， 现在需要修改ubuntu 虚拟机的磁盘大小。   *宿主机是什么其实无所谓。*

流程： 
- 关闭虚拟机
- 修改磁盘大小， 比如 20G -> 40G
- 启动虚拟机
- 执行命令： `lsblk /dev/sda`
  - *如果需要扩充的是第二块磁盘的话，可能需要输入`/dev/sdb`*
  - 确定需要扩充的分区索引号，  比如`sda3`  就是3号
  - 如果就一块磁盘的话， 可以查看`MOUNTPOINTS` 是 `/` 的那一个分区
- 执行命令： `growpart /dev/sda 3`
  - 这里的`3` 就是上面提到的分区索引号。
- 执行命令： `pvs`
  - 查看 `PFree` 一栏 是否有空闲空间
- 执行命令： `lvextend -l+100%FREE /dev/ubuntu-vg/ubuntu-lv`
- 执行命令： `df -hPT /`
  - 这个可以查看文件系统的空间大小
  - 最后的 `/`  应该是挂载点
- 执行命令： `resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv`
  - `resize2fs` 命令的参数 是上面命令的 Filesystem  列的内容
- 再次执行命令 `df -hPT /`  查看扩展后的空间。


### 收缩磁盘

新建一块小一些的磁盘， 然后把文件复制到新磁盘里面， 之后删除旧磁盘。  
注意：如果使用这种方法迁移系统盘的话，需要重新建立引导， 否则无法开机。 鉴于笔者并没有相关的经验，所以这里就略过了。


复制文件的话， 挂载另外一个磁盘到当前系统里面，然后进行复制即可。 如果有两个运行中的系统的话，也可以使用 rsync进行同步。 


## 拓展阅读

- https://askubuntu.com/a/1406922/1701779
- https://askubuntu.com/a/1078061/1701779




---

> 作者: Aincvy  
> URL: https://fantasyplayer.link/periphery/ubuntu-22.04-%E6%89%A9%E5%85%85%E7%A3%81%E7%9B%98-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%89%A9%E5%85%85%E7%A3%81%E7%9B%98/  

