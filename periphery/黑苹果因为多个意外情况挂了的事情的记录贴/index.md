# 黑苹果因为多个意外情况挂了的事情的记录贴




由于笔者使用的是黑苹果，所以能正常使用的话，尽量不升级比较好。 如果想升级的话， 还需要更新`OpenCore`的版本， 可能还会碰到各种乱七八糟的问题。 同时，笔者感觉Big Sur 并不是太好，所以完全没有升级的打算。

但是，意外总是会有的。 前些天， 笔者因为手误，点到了现在安装升级的选项。。 虽然及时的点击了取消， 但还是触发了一些悲剧操作。  本帖就是来记录一下这件事情的。

事后， 笔者想禁止掉系统的升级提示弹窗， 但是发现好像不行了。 自从 10.15.7 的版本之后， 系统升级的通知好像就无法禁止了。   网上一般提供的是这个命令 `sudo softwareupdate --ignore "macOS Catalina"` ，笔者再使用的时候会提示 下面的内容。

```plain
Ignored updates:
(
)

Software Update can only ignore updates that are eligible for installation.
If the label provided to ignore is not in the above list, it is not eligible
to be ignored.

Ignoring software updates is deprecated.
The ability to ignore individual updates will be removed in a future release of macOS.
```

大意是说现在不能忽略系统升级通知 ， 这个特性可能会在未来的版本中移出。



### Time machine 作为问题的导火索

现在回到正题， 笔者说一说前几天都发生了什么。

在不小心点了升级之后， 每次重启的时候，再系统选择界面都能看到一个叫`MacOS Installer`的选项， 应该是安装新系统使用的， 并且每次在这个地方的时候，这个选项是默认的。 必须手动更改到`Windows`或者`Macintosh HD` ，否则就会安装新系统。

在某一天晚上， 笔者的Time machine 报警了，说是磁盘空间不足。按理说应该会自动删除老旧的备份才对， 但是却没有。 并备份的日期只有最近几天的内容了， 且最后一次备份是再几天前。 所以笔者想手动删除磁盘， 然后重新备份。 

笔者首先解开了Time machine 的备份磁盘， 并且关闭了自动备份。

笔者使用`ForkLift`这个工具打开后看到 备份使用的文件夹是一个图表， 然后就不小心的双击了一下，双击之后并没有出现什么弹窗， 所以笔者也没有在意。

之后，笔者就手动尝试删除了文件夹。  

再删除的过程中，出现了一个意外。。 有部分文件被不知道哪个应用使用了， 删不掉， 我只能删除一部分文件， 且那部分文件已经被我删掉了， 并且无法找回。 

这说明Time machine 的备份已经坏掉了。。  我便尝试使用命令行进行删除操作。同样有部分文件不能删除。。。   

文件不能完全删掉， 笔者就以为不能进行重新备份， 得先完全删除文件夹才行。（*实际上能不能，笔者暂时并不清楚。。。*）

既然是某些应用使用了文件， 那么重启之后应该就可以删除了，笔者抱着这样的想法把电脑重启了。 

### 大意之下，问题出现了

选择重启之后， 笔者就跑到一边玩手机去了， 笔者忘记了选项这个问题。。 😥😥😥

等笔者抬起头看屏幕的时候发现， 已经到了启动界面， 大串大串的字符再屏幕上跳动。。  笔者一时间也不敢强行关机，怕发生不太好的事情。

等到了2分钟之后， 屏幕卡住了， 应该是笔者目前的`OpenCore`版本不支持`Big Sur`的安装。 之后又等了几分钟， 没出现什么变化。  笔者就强行关机重启了。 

重启之后，进入界面， 提示让笔者注册一个新的用户。 笔者不知道发生了什么，想着应该问题不大， 就注册了一个新的用户。  等注册结束之后， 笔者发现原来的用户还是存在的，所以就尝试登录原来的用户。  再登录的时候发现， 那个用户再输入密码之后会卡住。 小菊花一直在转， 进不去。 

重启机器， 尝试登录新用户， 可以成功登录。

尝试切换用户， 登录老用户， 仍然卡死。 

笔者此时决定切换到Windows，玩一会猎天使魔女再继续搞把。。

玩了两个多小时猎天使魔女之后， 笔者再Windows上尝试搜索原因， 笔者发现苹果官网似乎推荐可以尝试重置 NVRAM， SMC等。 

重启电脑， 再系统选择界面的地方， 笔者发现了 `Reset NVRAM` 这个选项，所以就重置了下NVRAM。 

### 得而复失的感觉真奇妙

再次登录， 居然成功了。  

可惜，虽然成功登录了， 但是还有新的问题：  应用程序基本都不见了， 并且之前安装的其他工具也都不见了(*python3, homebrew 等*)。

后来，经过一番搜索和探索， 笔者发现， 应用程序其实还在，只不过都被移动到了`/System/Volumes/Data/Recovered Items` 这个目录。 这个目录里面还有一些其他的系统级别的配置文件。 

笔者大喜🤣🤣🤣， 赶忙把程序移动到 `/Applications`这个文件夹里面。 后来又找了下， 发现这个文件夹里面还有几个隐藏文件夹，  `usr`,`etc` 仔细找找也有， etc 应该再一个叫做`private`的文件夹里面。

笔者这时想起自己原来要做的事情： 删除原来的 Time machine 备份， 这次尝试没有碰到任何问题，直接就成功的删除了。
之后便着手尝试恢复`/usr/local/bin`  等其他目录。 在恢复etc 文件夹的时候， 又出现了新的问题。。笔者直接使用原来的etc文件夹 进行了覆盖操作， 就是把现有的文件夹给覆盖掉了。  再覆盖之后，笔者发现笔者的密码无效了。  

笔者的密码肯定是正确的，但是就是使用不了， 每次都提示错误。  笔者以为这是一个常规问题，所以进行了重启操作， 等重启之后发现， 这其实并不是一个常规问题， 现在连系统都登录不了了😢😢😢。

笔者尝试了若干操作， 发现就是使用不了密码， 同时另外一个新建的账户也登录不了了。

- 重启之后，进入恢复模式，使用 `resetpassword`工具进行密码重设， 重设了好几次，都没用
- 使用`Reset NVRAM` 选项

这时候，只有一个操作可以尝试了， 那就是： 重装系统。 

笔者进入恢复模式， 选择重装系统的时候， 提示笔者需要网络才能重装。。 笔者没有配备免驱的网卡和无线网卡。。 在恢复模式下， 部分硬件不工作。。 没得办法， 笔者又去购买了一个免驱的无线网卡。 

### 大部分问题的解决之道： 重启 && 重装系统

次日，等无线网卡装上之后， 就进行了重装系统的操作。 等待系统安装结束， 笔者发现可以使用原来的密码进行登录了！ 

进入系统之后， 笔者发现很多窗口回来了， 又简单了熟悉的画面。 笔者表示很开心，折腾了这么久，终于好了。 😀😀😀

笔者尝试寻找了一下`/System/Volumes/Data/Recovered Items`这个文件夹， 然后发现该文件夹已经消失， 估计是再重装系统之后， 对这个文件夹进行了一个更改和应用。 

*mac 的系统分区和数据分区是分开的， 重装的时候 可以保留文件。  Windows也有类似的选项。*





---

> 作者: hideDragon  
> URL: https://fantasyplayer.link/periphery/%E9%BB%91%E8%8B%B9%E6%9E%9C%E5%9B%A0%E4%B8%BA%E5%A4%9A%E4%B8%AA%E6%84%8F%E5%A4%96%E6%83%85%E5%86%B5%E6%8C%82%E4%BA%86%E7%9A%84%E4%BA%8B%E6%83%85%E7%9A%84%E8%AE%B0%E5%BD%95%E8%B4%B4/  

